<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.92.2" />


<title>Linux (Debian Squeeze) on Thinkpad T500 - ./gibson.sh --blog</title>
<meta property="og:title" content="Linux (Debian Squeeze) on Thinkpad T500 - ./gibson.sh --blog">
<meta property="og:type" content="summary" />
<meta property="og:description" content="I recently got myself a Lenovo Thinkpad T500 (2055V1X) . I chose this older model over the T510 and such, because I prefer a screen resolution of 1680x1050 over a crippled 1600x900 or worse. I write and read a lot of code so I need vertical space on the display and I&rsquo;d definitely miss the 150pixels additional vertical space my old Laptop (Samsung X20 with a resolution of 1400x1050) has.
However, I shrunk the Windows 7 partition (I didn&rsquo;t want to dump Windows entirely) and installed Debian Squeeze (AMD64) in the resulting free space. I&rsquo;m very pleased how painless everything was, almost all hardware ran out of the box, but I&rsquo;ll document some interesting stuff (how to shrink windows partition without breaking it, how to make special keys work and display information on Linux, how to make the touchpad and trackpoint behave the way I want, &hellip;) anyway." />

<meta name="twitter:creator" content="@Doomed_Daniel" />
<meta property="og:image" content="http://blog.gibson.sh/images/logo-160.png" />

<link rel="me" href="https://mastodon.gamedev.place/@Doomed_Daniel" />



<link rel="stylesheet" href="../../../../css/main.css" media="all" />
<link rel="stylesheet" href="../../../../css/fonts.css" />


  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="../../../../" class="nav-logo" title="Home">
    <img src="../../../../images/logo.png"
        alt="Home" >
  </a>

  <ul class="nav-links">
    <li><b><a href="../../../../">Home</a></b></li>
    
    <li><a href="../../../../about/">About</a></li>
    
    <li><a href="https://github.com/DanielGibson/">Github</a></li>
    
    <li><a href="https://mastodon.gamedev.place/@Doomed_Daniel">Mastodon</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    

    <h1 class="article-title">Linux (Debian Squeeze) on Thinkpad T500</h1>

    
    <span class="article-date">January 5, 2011</span>
    

    <div class="article-content">
      <p>I recently got myself a Lenovo <!-- raw HTML omitted -->Thinkpad T500<!-- raw HTML omitted --> (2055V1X) . I chose this older model over the T510 and such, because I prefer a screen resolution of 1680x1050 over a crippled 1600x900 or worse. I write and read a lot of code so I need vertical space on the display and I&rsquo;d definitely miss the 150pixels additional vertical space my old Laptop (Samsung X20 with a resolution of 1400x1050) has.</p>
<p>However, I shrunk the Windows 7 partition (I didn&rsquo;t want to dump Windows entirely) and installed Debian Squeeze (AMD64) in the resulting free space. I&rsquo;m very pleased how painless everything was, almost all hardware ran out of the box, but I&rsquo;ll document some interesting stuff (how to shrink windows partition without breaking it, how to make special keys work and display information on Linux, how to make the touchpad and trackpoint behave the way I want, &hellip;) anyway.</p>
<h3 id="shrinking-windows">Shrinking Windows</h3>
<p>There were three partitions: a small one (about 1,2GB) called SYSTEM_DRV, which seems to be a Win7 boot partition (since when does Windows have a seperate partition for that?), on the second one was the Windows installation (this is the one I shrunk) and the third one of about 9,8GB that contained Lenovo recovery stuff (double-clicking it lets you burn that stuff onto three DVDs - which may make sense because Lenovo doesn&rsquo;t ship any DVDs/CDs with the Thinkpad so if your harddrive fails you&rsquo;re fscked).
I defragmentated the system partition and then tried to shrink it with Windows onboard-tools (<!-- raw HTML omitted -->here is a description<!-- raw HTML omitted -->), but it was not satisfactory: even though &ldquo;only&rdquo; 24GB were used by Windows and all that preinstalled crap, I could only shrink the partition to a size of 190GB, if I recall correctly. The reason was some unmovable system file or something like that.<br>
I wanted to shrink it to 100GB, so I used the Linux tool <!-- raw HTML omitted -->GParted<!-- raw HTML omitted --> from the <!-- raw HTML omitted -->grml Live-CD<!-- raw HTML omitted --> to do the job, which it did without any problems: On the next boot Windows did a file system check or repair or something and kept on functioning without any complaints.</p>
<h3 id="preparation">Preparation</h3>
<p>Before installing Debian I got the Squeeze Beta2 netinstall ISO from
<!-- raw HTML omitted --><a href="http://cdimage.debian.org/cdimage/daily-builds/squeeze_d-i/amd64/iso-cd/">http://cdimage.debian.org/cdimage/daily-builds/squeeze_d-i/amd64/iso-cd/</a><!-- raw HTML omitted --> and burned it to a CDRW.<br>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->Update: Squeeze is now stable, use the netinstall ISO from <!-- raw HTML omitted --><a href="http://debian.org/CD/netinst/">http://debian.org/CD/netinst/</a><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>My T500 has got two display adapters: An Intel GMA X4500 and a AMD Mobility Radeon HD 3650. Only very recent versions of the Linux kernel (2.6.34 onwards as far as I know) support switching between them at runtime (but still X needs to be restarted) - Squeeze is still at 2.6.32, so that won&rsquo;t work without a custom kernel. See <!-- raw HTML omitted -->the ThinkWiki<!-- raw HTML omitted --> for further information.<br>
One can still switch the adapters in the BIOS (press F1 after powering on the Thinkpad). Because I don&rsquo;t need much 3D power at the moment and prefer longer battery life, a better driver and a cooler laptop I chose to use the Intel Chip (&ldquo;Discrete Graphics&rdquo;). Because of that I won&rsquo;t describe how to make the Radeon work, but it shouldn&rsquo;t be too painful (either use the default free driver or install the proprietary fglrx).
My settings in the BIOS (Config -&gt; Display) look like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Default Primary Video Device  [Internal]
Boot Display Device           [Thinkpad LCD]
Graphics Device               [Integrated Display]
OS Detection for Switchable Graphics 
                              [Disabled]
</code></pre></div><p>To install Debian you want to have Ethernet (wired LAN) ready for Internet-access, because the wireless chip in the T500 (at least in mine) needs proprietary firmware from Intel that Debian doesn&rsquo;t include by default.
However, if you&rsquo;ve only got wireless Internet you can supply the firmware from a USB-stick, the Debian installer will prompt for that.
<!-- raw HTML omitted --><!-- raw HTML omitted -->Update:<!-- raw HTML omitted --><!-- raw HTML omitted --> See <!-- raw HTML omitted -->the debian Wiki<!-- raw HTML omitted --> for more information, including links to netinstall-ISOs that include firmware.</p>
<h3 id="installing-debian">Installing Debian</h3>
<p>Just insert the CD, boot, follow the instructions (I won&rsquo;t describe that in detail, because that&rsquo;s not the point of this article).
Some notes:</p>
<!-- raw HTML omitted -->
<h4 id="getting-wifi-firmware">Getting WiFi firmware</h4>
<p>After installing the basic stuff and rebooting to my new debian installation, I installed the WiFi firmware.
First I modified <!-- raw HTML omitted -->/etc/apt/sources.list<!-- raw HTML omitted --> to also use the <!-- raw HTML omitted -->contrib<!-- raw HTML omitted --> and <!-- raw HTML omitted -->non-free<!-- raw HTML omitted --> repositories, so the entries looked like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">deb http://ftp.de.debian.org/debian/ squeeze main contrib non-free
deb-src http://ftp.de.debian.org/debian/ squeeze main contrib non-free

deb http://security.debian.org/ squeeze/updates main contrib non-free
deb-src http://security.debian.org/ squeeze/updates main contrib non-free
</code></pre></div><p>(Yours may look slightly different, depending on the mirror you selected).
After an <!-- raw HTML omitted -->apt-get update<!-- raw HTML omitted --> I installed the packages <!-- raw HTML omitted -->firmware-linux<!-- raw HTML omitted --> (not sure if this is really needed, maybe for the radeon) and <!-- raw HTML omitted -->firmware-iwlwifi<!-- raw HTML omitted --> (this one is definitely needed for wireless LAN, at least if you&rsquo;ve got a &ldquo;Intel Wifi Link 5100&rdquo; or 5300 like me).</p>
<p>For using wireless LAN network-manager-gnome and the gnome-keyring (to store network keys) may come in handy. See <!-- raw HTML omitted -->my post on how to unlock the gnome-keyring on login when using the SLiM display manager<!-- raw HTML omitted --> for more on that.</p>
<h4 id="protecting-you-hard-disk-drive-with-hdaps">Protecting you hard disk drive with HDAPS</h4>
<p>Thinkpads have a cool feature to protect the HDD from falling damage: The <!-- raw HTML omitted -->IBM Active Protection System<!-- raw HTML omitted -->. On Linux this is supported by the HDAPS kernel driver and the hdapsd userspace daemon. To get a recent version of the kernel driver you have to install the tp-smapi driver package. It&rsquo;s available in apt in both the <!-- raw HTML omitted -->tp-smapi-source<!-- raw HTML omitted --> package and the <!-- raw HTML omitted -->tp-smapi-dkms<!-- raw HTML omitted --> package (I installed the latter).
The hdaps daemon is also available via apt, the package is called <!-- raw HTML omitted -->hdapsd<!-- raw HTML omitted -->. It should just work out of the box.</p>
<h4 id="hibernate-support">Hibernate support</h4>
<p>Hibernate works out of the box. But there&rsquo;s a keyboard-shortcut to start hibernation, that doesn&rsquo;t: <!-- raw HTML omitted -->Fn-F12<!-- raw HTML omitted -->. It sends a ACPI button/suspend message and by default there is no ACPI handler for that event. This can be easily fixed, though: Just create a file <!-- raw HTML omitted -->/etc/acpi/events/hibernatebtn<!-- raw HTML omitted --> with the following content and after a reboot the button should work:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># /etc/acpi/events/hibernatebtn</span>
<span class="c1"># Called when the user presses the hibernate button</span>

<span class="nv">event</span><span class="o">=</span>button<span class="o">[</span> /<span class="o">]</span><span class="nb">suspend</span>
<span class="nv">action</span><span class="o">=</span>/etc/acpi/hibernatebtn.sh
</code></pre></div><h4 id="disabling-the-pc-speaker">Disabling the PC speaker</h4>
<p>To get rid of that annoying beep on several occasions (tab-completion, end of file in less, &hellip;), add the following to the <!-- raw HTML omitted -->/etc/modprobe.d/blacklist.conf<!-- raw HTML omitted --> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># no beeps, plz</span>
blacklist pcspkr
blacklist snd_pcsp
</code></pre></div><p>Note that this doesn&rsquo;t deactivate all beeps: The Thinkpad seems to beep independently of the OS e.g. on resume (after hibernate/standby) or when the power chord is plugged in or removed.</p>
<h3 id="x-org-desktop-specific-stuff">X.org/Desktop specific stuff</h3>
<p>The following stuff concerns X.org. It&rsquo;s independent from a specific desktop environment (like XFCE, GNOME, KDE, &hellip;) - but it may well be that some of this can also be done with tools from the desktop environment.</p>
<h4 id="make-the-ultranav-touchpad-trackpoint-behave-the-way-i-want">Make the &ldquo;UltraNav&rdquo; (Touchpad/Trackpoint) behave the way I want</h4>
<p>Both the Touchpad and the Trackpoint work out of the box. They can be further configured with a tool like <!-- raw HTML omitted -->gpointing-device-settings<!-- raw HTML omitted --> or similar tools from your desktop environment.
However, two things could not be configured with gpointing-device-settings:</p>
<!-- raw HTML omitted -->
<h4 id="special-keys">Special Keys</h4>
<p>The Thinkpad has a lot of special keys (or key-combinations), e.g. to configure the brightness, the volume, &hellip;<br>
Some of them (e.g. brightness) already work, but it&rsquo;d be nice to have some additional on-screen information, other don&rsquo;t do anything without further configuration.
(A special case is the hibernate button that I&rsquo;ve mentioned earlier, because it is configured via ACPI handlers and not in X)<br>
I used the desktop-independent <!-- raw HTML omitted -->xbindkeys<!-- raw HTML omitted --> tool (from the identically named debian package) to support those keys. The <!-- raw HTML omitted -->xbindkeys-config<!-- raw HTML omitted --> utility is really handy to modify xbindkey&rsquo;s configuration file, <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted -->. However, for xbindkeys-config to work you need a <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> file (it may even be empty) or it&rsquo;ll crash, so just execute <!-- raw HTML omitted --><!-- raw HTML omitted -->$ touch ~/.xbindkeysrc<!-- raw HTML omitted --><!-- raw HTML omitted --> before doing anything else.
After installing xbindkeys you should make sure it&rsquo;s started when you log into X. One way to do so is to just add the following line to the <!-- raw HTML omitted -->~/.profile<!-- raw HTML omitted --> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># ...</span>
<span class="c1"># start xbindkeys</span>
xbindkeys <span class="p">&amp;</span>
</code></pre></div><p>Also most of the scripts for the special keys use the <!-- raw HTML omitted -->osd_cat<!-- raw HTML omitted --> tool from the <!-- raw HTML omitted -->xosd-bin<!-- raw HTML omitted --> package to display information on the screen, so you should install it.</p>
<h5 id="brightness-control">Brightness Control</h5>
<p>The keys to control the display&rsquo;s brightness (Fn-Home/Pos1 and Fn-End) already work out the box. But it would be nice if the current brightness level (there are 16: 0-15) was displayed on the screen along with a nice bar.. the following script (save it to some dir in you $PATH, e.g. <!-- raw HTML omitted -->/usr/local/bin/<!-- raw HTML omitted --> and make it executable (<!-- raw HTML omitted -->chmod 755 /usr/local/bin/brightness.sh<!-- raw HTML omitted -->) does that:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$XAUTHORITY</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c1"># kill other osd_cat processes to prevent overlapping</span>
        <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -A <span class="p">|</span> grep osd_cat <span class="p">|</span> wc -l<span class="k">)</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                killall osd_cat
        <span class="k">fi</span>
        <span class="nv">i</span><span class="o">=</span><span class="k">$(</span>cat /sys/class/backlight/acpi_video0/brightness<span class="k">)</span>    
        <span class="nb">let</span> <span class="nv">i_perc</span><span class="o">=(</span>100*<span class="nv">$i</span><span class="o">)</span>/15
        osd_cat -d <span class="m">1</span> -A center -p bottom -o <span class="m">50</span> -c yellow -s <span class="m">1</span> <span class="se">\
</span><span class="se"></span>        -f -adobe-courier-bold-r-normal--*-240-*-*-m-*-iso8859-1 <span class="se">\
</span><span class="se"></span>        -b percentage -P <span class="nv">$i_perc</span> -T <span class="s2">&#34;Brightness: </span><span class="nv">$i</span><span class="s2"> / 15&#34;</span>
<span class="k">fi</span>
</code></pre></div><p>Make sure the path (<!-- raw HTML omitted -->/sys/class/backlight/acpi_video0/brightness<!-- raw HTML omitted -->) is correct for you or change it accordingly.<br>
Now either use <!-- raw HTML omitted -->xbindkeys-config<!-- raw HTML omitted --> to make sure this script is called if either Fn-Home or Fn-End is pressed or add the following to the <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> file (At the end I&rsquo;ll paste my complete ~/.xbindkeysrc file.):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#brightness up
&#34;brightness.sh&#34;
    m:0x0 + c:233
    XF86MonBrightnessUp 

#brightness down
&#34;brightness.sh&#34;
    m:0x0 + c:232
    XF86MonBrightnessDown 
</code></pre></div><h5 id="switch-touchpad-on-off">Switch Touchpad on/off</h5>
<p>Fn-F8 is meant to toggle between touchpad, Trackpoint and both.. I see no point in disabling the Trackpoint so I just use it to disable/enable the touchpad.
So by pressing Fn-F8 you&rsquo;ll get a nice OSD info saying &ldquo;Touchpad OFF&rdquo; or &ldquo;Touchpad ON&rdquo; and the touchpad will be switched off/on.<br>
Save the following code as <!-- raw HTML omitted -->toggletouchpad.sh<!-- raw HTML omitted --> somewhere in your $PATH and make it executable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># adapted from http://forums.gentoo.org/viewtopic-p-6241953.html?sid=815e3e5f2bb9ccfbef0c8ff6cb37914b#6241953</span>

<span class="k">if</span> synclient -l <span class="p">|</span> grep -q TouchpadOff<span class="o">[</span>^<span class="o">[</span>:alnum:<span class="o">]]</span>*0 <span class="p">;</span> <span class="k">then</span>     
   synclient <span class="nv">TouchpadOff</span><span class="o">=</span><span class="m">1</span>                                     
   <span class="nv">status</span><span class="o">=</span><span class="s2">&#34;TouchPad OFF&#34;</span>                                       
<span class="k">else</span>
   synclient <span class="nv">TouchpadOff</span><span class="o">=</span><span class="m">0</span>
   <span class="nv">status</span><span class="o">=</span><span class="s2">&#34;TouchPad ON&#34;</span>
<span class="k">fi</span>

<span class="c1"># kill other osd_cat processes to prevent overlapping</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -A <span class="p">|</span> grep osd_cat <span class="p">|</span> wc -l<span class="k">)</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    killall osd_cat
<span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$XAUTHORITY</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="nv">$status</span> <span class="p">|</span> osd_cat -d <span class="m">3</span> -p bottom -A center -o -50 -s <span class="m">1</span> -c green <span class="se">\
</span><span class="se"></span>    -f -adobe-courier-bold-r-normal--*-240-*-*-m-*-iso8859-1 
<span class="k">fi</span>
</code></pre></div><p>Add the following to your <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> (or use xbindkeys-config to map the key yourself):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#toggle touchpad
&#34;toggletouchpad.sh&#34;
    m:0x0 + c:199
    NoSymbol 
</code></pre></div><h5 id="configure-display">Configure display</h5>
<p>Fn-F7 is meant to configure display output (to the internal LVDS display or the external VGA and DisplayPort ports).<br>
With Linux/X.org these configurations can be done with <!-- raw HTML omitted -->RandR<!-- raw HTML omitted -->. A nice GUI for randr is <!-- raw HTML omitted -->arandr<!-- raw HTML omitted --> (available via apt), so I just start arandr whenever Fn-F7 is pressed.
<!-- raw HTML omitted --><!-- raw HTML omitted -->Note:<!-- raw HTML omitted --><!-- raw HTML omitted --> Fn-F7 is identified as the XF86Display key. XFCE has a default mapping for that (it executes <!-- raw HTML omitted -->xrandr &ndash;auto<!-- raw HTML omitted --> which is supposed to do something useful, but..) so you may need to disable that default mapping. In XFCE that is done in the keyboard settings.</p>
<p>Add the following to your <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> (or use xbindkeys-config to map the key yourself):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#configure display
&#34;arandr&#34;
    m:0x0 + c:235
    XF86Display 
</code></pre></div><h5 id="volume-keys">Volume Keys</h5>
<p>There are three keys to control the volume: One for mute, one to increase the volume and one to decrease it.
The script uses amixer (from the <!-- raw HTML omitted -->alsa-utils<!-- raw HTML omitted --> package) to change the volume and also outputs the current volume/status.
Save it as <!-- raw HTML omitted -->volume.sh<!-- raw HTML omitted --> and make it executable:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/usr/bin/env bash
</span><span class="cp"></span><span class="c1"># adapted from http://ztatlock.blogspot.com/2009/01/volume-control-with-amixer-and-osdcat.html</span>

<span class="nv">CHANNEL</span><span class="o">=</span>Master

<span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;-h&#34;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;--help&#34;</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
  <span class="nv">p</span><span class="o">=</span><span class="k">$(</span>basename <span class="nv">$0</span><span class="k">)</span>
  cat <span class="s">&lt;&lt;HERE
</span><span class="s">
</span><span class="s">  Usage: $p &lt;channel&gt; &lt;option&gt;
</span><span class="s">  where option is in {+, -, m, u} or is a percent
</span><span class="s">  e.g. $p 50       # sets $CHANNEL to 50%
</span><span class="s">           $p Front m  # toggles the mute of the channel Front
</span><span class="s">
</span><span class="s">HERE</span>
  <span class="nb">exit</span> <span class="m">0</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$#</span> -eq <span class="m">2</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
  <span class="nv">CHANNEL</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">shift</span>
<span class="k">fi</span>

<span class="k">function</span> vol_level <span class="o">{</span>
  amixer get <span class="nv">$CHANNEL</span> <span class="p">|</span><span class="se">\
</span><span class="se"></span>  grep <span class="s1">&#39;Front Left:&#39;</span>  <span class="p">|</span><span class="se">\
</span><span class="se"></span>  cut -d <span class="s2">&#34; &#34;</span> -f <span class="m">7</span>     <span class="p">|</span><span class="se">\
</span><span class="se"></span>  sed <span class="s1">&#39;s/[^0-9]//g&#39;</span>
<span class="o">}</span>


<span class="k">function</span> osd <span class="o">{</span>
  killall osd_cat <span class="p">&amp;</span>&gt; /dev/null
  <span class="nb">echo</span> <span class="nv">$*</span> <span class="p">|</span><span class="se">\
</span><span class="se"></span>  osd_cat -d <span class="m">2</span> -l <span class="m">1</span> -p bottom -c green -s <span class="m">1</span> -A center -o <span class="m">50</span> <span class="se">\
</span><span class="se"></span>    -f <span class="s1">&#39;-adobe-courier-bold-r-normal--*-240-*-*-m-*-iso8859-1&#39;</span> <span class="p">&amp;</span>
<span class="o">}</span>

<span class="k">function</span> mute_osd <span class="o">{</span>
        <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>amixer get <span class="nv">$CHANNEL</span> <span class="p">|</span> grep Playback <span class="p">|</span> grep <span class="s2">&#34;\[on\]&#34;</span> <span class="p">|</span> wc -l<span class="k">)</span> -gt <span class="m">0</span> <span class="o">]</span>
        <span class="k">then</span>
                osd <span class="nv">$CHANNEL</span> Unmuted
        <span class="k">else</span>
                osd <span class="nv">$CHANNEL</span> Muted
        <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> vol_osd <span class="o">{</span>
  killall osd_cat <span class="p">&amp;</span>&gt; /dev/null
  osd_cat -d <span class="m">2</span> -l <span class="m">2</span> -p bottom -c green -s <span class="m">1</span> -A center -o <span class="m">50</span> <span class="se">\
</span><span class="se"></span>    -f <span class="s1">&#39;-adobe-courier-bold-r-normal--*-240-*-*-m-*-iso8859-1&#39;</span> <span class="se">\
</span><span class="se"></span>        -T <span class="s2">&#34;Volume (</span><span class="nv">$CHANNEL</span><span class="s2">) : </span><span class="k">$(</span>vol_level<span class="k">)</span><span class="s2"> %&#34;</span> -b percentage -P <span class="k">$(</span>vol_level<span class="k">)</span> <span class="p">&amp;</span>
<span class="o">}</span>

<span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> in
  <span class="s2">&#34;+&#34;</span><span class="o">)</span>
        amixer -q <span class="nb">set</span> <span class="nv">$CHANNEL</span> 5%+
        vol_osd
        <span class="p">;;</span>
  <span class="s2">&#34;-&#34;</span><span class="o">)</span>
        amixer -q <span class="nb">set</span> <span class="nv">$CHANNEL</span> 5%-
        vol_osd
        <span class="p">;;</span>
  <span class="s2">&#34;m&#34;</span><span class="o">)</span>
        amixer -q <span class="nb">set</span> <span class="nv">$CHANNEL</span> toggle
        mute_osd
        <span class="p">;;</span>
  *<span class="o">)</span>
        amixer -q <span class="nb">set</span> <span class="nv">$CHANNEL</span> <span class="nv">$1</span>%
        <span class="p">;;</span>
<span class="k">esac</span>
</code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Note:<!-- raw HTML omitted --><!-- raw HTML omitted --> Due to a bug, probably in the sound driver or hardware, muting doesn&rsquo;t really work with this script (because muting master has no effect). Maybe I&rsquo;ll fix the script to use a workaround later.<!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted -->Update:<!-- raw HTML omitted --> Muting Master does work now (it actually has been working for months), probably due to an updated Kernel in Debian Squeeze.<!-- raw HTML omitted --></p>
<p>Add the following to your <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> (or use xbindkeys-config to map the key yourself):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#Volume Up
&#34;volume.sh +&#34;
    m:0x0 + c:123
    XF86AudioRaiseVolume 

#Volume Down
&#34;volume.sh -&#34;
    m:0x0 + c:122
    XF86AudioLowerVolume 

#Volume (Un)Mute
&#34;volume.sh m&#34;
    m:0x0 + c:121
    XF86AudioMute
</code></pre></div><h5 id="lock-screen">Lock Screen</h5>
<p>Fn-F2 is used to lock the screen. If you&rsquo;re using <!-- raw HTML omitted -->xscreensaver<!-- raw HTML omitted --> you can just call <!-- raw HTML omitted -->xscreensaver-command -lock<!-- raw HTML omitted --> to lock the screen.
To do that add the following to your <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> (or use xbindkeys-config to map the key yourself):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#Lock Screen
&#34;xscreensaver-command -lock&#34;
    m:0x0 + c:160
    XF86ScreenSaver 
</code></pre></div><h5 id="battery-status">Battery Status</h5>
<p>Fn-F3 has a battery symbol. I&rsquo;m not sure what it&rsquo;s supposed to do, but just displaying the current battery status (percentage and if it&rsquo;s charging, discharging or whatever) may be nice.
The following script (save it as <!-- raw HTML omitted -->batteryinfo.sh<!-- raw HTML omitted --> to you $PATH and make it executable) does exactly that:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1"># path to your battery. make sure it&#39;s correct</span>
<span class="nv">BAT_PATH</span><span class="o">=</span><span class="s2">&#34;/sys/class/power_supply/BAT0&#34;</span>

<span class="k">if</span> <span class="o">[</span> -n <span class="s2">&#34;</span><span class="nv">$XAUTHORITY</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="c1"># kill other osd_cat processes to prevent overlapping</span>
        <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ps -A <span class="p">|</span> grep osd_cat <span class="p">|</span> wc -l<span class="k">)</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
                killall osd_cat
        <span class="k">fi</span>
        <span class="nv">BAT_FULL</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$BAT_PATH</span>/energy_full<span class="k">)</span>
        <span class="nv">BAT_NOW</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$BAT_PATH</span>/energy_now<span class="k">)</span>
        <span class="nv">STATUS</span><span class="o">=</span><span class="k">$(</span>cat <span class="nv">$BAT_PATH</span>/status<span class="k">)</span>
        <span class="nb">let</span> <span class="nv">perc</span><span class="o">=(</span>100*<span class="nv">$BAT_NOW</span><span class="o">)</span>/<span class="nv">$BAT_FULL</span>

        osd_cat -d <span class="m">2</span> -A center -p bottom -o <span class="m">50</span> -c yellow -s <span class="m">1</span> <span class="se">\
</span><span class="se"></span>         -f -adobe-courier-bold-r-normal--*-240-*-*-m-*-iso8859-1 <span class="se">\
</span><span class="se"></span>         -b percentage -P <span class="nv">$perc</span> -T <span class="s2">&#34;Battery </span><span class="nv">$perc</span><span class="s2"> % loaded, </span><span class="nv">$STATUS</span><span class="s2">&#34;</span>
<span class="k">fi</span>
</code></pre></div><p>Add the following to your <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> to make it work:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">#Battery Status
&#34;batteryinfo.sh&#34;
    m:0x0 + c:244
    XF86Battery 
</code></pre></div><p>I haven&rsquo;t mapped the remaining special keys (like play, pause, &hellip;) yet, but as you may already have guessed, this could easily be done with xbindkeys. Use either xbindkeys-config to do that or create the entries for the <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted --> yourself - you can get the keycodes with <!-- raw HTML omitted -->xbindkeys -k<!-- raw HTML omitted -->.</p>
<p>My complete <!-- raw HTML omitted -->~/.xbindkeysrc<!-- raw HTML omitted -->:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">###########################</span>
<span class="c1"># xbindkeys configuration #</span>
<span class="c1">###########################</span>
<span class="c1">#</span>
<span class="c1"># Version: 0.1.3</span>
<span class="c1">#</span>
<span class="c1"># If you edit this, do not forget to uncomment any lines that you change.</span>
<span class="c1"># The pound(#) symbol may be used anywhere for comments.</span>
<span class="c1">#</span>
<span class="c1"># A list of keys is in /usr/include/X11/keysym.h and in</span>
<span class="c1"># /usr/include/X11/keysymdef.h </span>
<span class="c1"># The XK_ is not needed. </span>
<span class="c1">#</span>
<span class="c1"># List of modifier (on my keyboard): </span>
<span class="c1">#   Control, Shift, Mod1 (Alt), Mod2 (NumLock), </span>
<span class="c1">#   Mod3 (CapsLock), Mod4, Mod5 (Scroll). </span>
<span class="c1">#</span>
<span class="c1"># Another way to specifie a key is to use &#39;xev&#39; and set the </span>
<span class="c1"># keycode with c:nnn or the modifier with m:nnn where nnn is </span>
<span class="c1"># the keycode or the state returned by xev </span>
<span class="c1">#</span>
<span class="c1"># This file is created by xbindkey_config </span>
<span class="c1"># The structure is : </span>
<span class="c1"># # Remark </span>
<span class="c1"># &#34;command&#34; </span>
<span class="c1"># m:xxx + c:xxx </span>
<span class="c1"># Shift+... </span>

<span class="c1">#keystate_numlock = enable</span>
<span class="c1">#keystate_scrolllock = enable</span>
<span class="c1">#keystate_capslock = enable</span>

<span class="c1">#toggle touchpad</span>
<span class="s2">&#34;toggletouchpad.sh&#34;</span>
    m:0x0 + c:199
    NoSymbol 

<span class="c1">#configure display</span>
<span class="s2">&#34;arandr&#34;</span>
    m:0x0 + c:235
    XF86Display 

<span class="c1">#brightness up</span>
<span class="s2">&#34;brightness.sh&#34;</span>
    m:0x0 + c:233
    XF86MonBrightnessUp 

<span class="c1">#brightness down</span>
<span class="s2">&#34;brightness.sh&#34;</span>
    m:0x0 + c:232
    XF86MonBrightnessDown 

<span class="c1">#Volume Up</span>
<span class="s2">&#34;volume.sh +&#34;</span>
    m:0x0 + c:123
    XF86AudioRaiseVolume 

<span class="c1">#Volume Down</span>
<span class="s2">&#34;volume.sh -&#34;</span>
    m:0x0 + c:122
    XF86AudioLowerVolume 

<span class="c1">#Volume (Un)Mute</span>
<span class="s2">&#34;volume.sh m&#34;</span>
    m:0x0 + c:121
    XF86AudioMute 

<span class="c1">#Lock Screen</span>
<span class="s2">&#34;xscreensaver-command -lock&#34;</span>
    m:0x0 + c:160
    XF86ScreenSaver 

<span class="c1">#Battery Status</span>
<span class="s2">&#34;batteryinfo.sh&#34;</span>
    m:0x0 + c:244
    XF86Battery 

<span class="c1">#</span>
<span class="c1"># End of xbindkeys configuration</span>
</code></pre></div><h3 id="what-also-works-tested">What also works (tested)</h3>
<!-- raw HTML omitted -->
<h3 id="what-doesn-t-work">What doesn&rsquo;t work</h3>
<!-- raw HTML omitted -->
<h3 id="untested">Untested</h3>
<!-- raw HTML omitted -->
<h3 id="update-output-of-lspci-and-lsusb"><em>Update:</em> Output of lspci and lsusb</h3>
<p>I figured it may be a good idea to paste the output of lspci and lsusb. Note that the radeon is disabled via BIOS, so it isn&rsquo;t listed. I highlighted the lines listing non-working hardware.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">caedes@Cyberdemon:~$ lspci 
00:00.0 Host bridge: Intel Corporation Mobile 4 Series Chipset Memory Controller Hub (rev 07)
00:02.0 VGA compatible controller: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller (rev 07)
00:02.1 Display controller: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller (rev 07)
00:03.0 Communication controller: Intel Corporation Mobile 4 Series Chipset MEI Controller (rev 07)
00:03.3 Serial controller: Intel Corporation Mobile 4 Series Chipset AMT SOL Redirection (rev 07)
00:19.0 Ethernet controller: Intel Corporation 82567LM Gigabit Network Connection (rev 03)
00:1a.0 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #4 (rev 03)
00:1a.1 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #5 (rev 03)
00:1a.2 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #6 (rev 03)
00:1a.7 USB Controller: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #2 (rev 03)
00:1b.0 Audio device: Intel Corporation 82801I (ICH9 Family) HD Audio Controller (rev 03)
00:1c.0 PCI bridge: Intel Corporation 82801I (ICH9 Family) PCI Express Port 1 (rev 03)
00:1c.1 PCI bridge: Intel Corporation 82801I (ICH9 Family) PCI Express Port 2 (rev 03)
00:1c.2 PCI bridge: Intel Corporation 82801I (ICH9 Family) PCI Express Port 3 (rev 03)
00:1c.3 PCI bridge: Intel Corporation 82801I (ICH9 Family) PCI Express Port 4 (rev 03)
00:1c.4 PCI bridge: Intel Corporation 82801I (ICH9 Family) PCI Express Port 5 (rev 03)
00:1d.0 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #1 (rev 03)
00:1d.1 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #2 (rev 03)
00:1d.2 USB Controller: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #3 (rev 03)
00:1d.7 USB Controller: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #1 (rev 03)
00:1e.0 PCI bridge: Intel Corporation 82801 Mobile PCI Bridge (rev 93)
00:1f.0 ISA bridge: Intel Corporation ICH9M-E LPC Interface Controller (rev 03)
00:1f.2 SATA controller: Intel Corporation ICH9M/M-E SATA AHCI Controller (rev 03)
00:1f.3 SMBus: Intel Corporation 82801I (ICH9 Family) SMBus Controller (rev 03)
03:00.0 Network controller: Intel Corporation Ultimate N WiFi Link 5300
<span class="hl">04:00.0 Memory controller: Intel Corporation Turbo Memory Controller (rev 11) ## doesn&#39;t work
</span>15:00.0 CardBus bridge: Ricoh Co Ltd RL5c476 II (rev ba)
15:00.1 FireWire (IEEE 1394): Ricoh Co Ltd R5C832 IEEE 1394 Controller (rev 04)
15:00.2 SD Host controller: Ricoh Co Ltd R5C822 SD/SDIO/MMC/MS/MSPro Host Adapter (rev 21)
15:00.3 System peripheral: Ricoh Co Ltd R5C843 MMC Host Controller (rev ff)
15:00.4 System peripheral: Ricoh Co Ltd R5C592 Memory Stick Bus Host Adapter (rev 11)
15:00.5 System peripheral: Ricoh Co Ltd xD-Picture Card Controller (rev 11)

caedes@Cyberdemon:~$ lsusb 
Bus 008 Device 002: ID 17ef:1003 Lenovo Integrated Smart Card Reader
Bus 008 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 004 Device 004: ID 0a5c:2145 Broadcom Corp. Bluetooth with Enhanced Data Rate II
<span class="hl">Bus 004 Device 002: ID 08ff:2810 AuthenTec, Inc. AES2810 ## doesn&#39;t work
</span>Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 003 Device 002: ID 0bdb:1900 Ericsson Business Mobile Networks BV F3507g Mobile Broadband Module
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub
Bus 001 Device 004: ID 17ef:4807 Lenovo UVC Camera
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div>
    </div>
  </article>

  

  <hr>

  <div id="gh-comments">
    <h4>COMMENTS</h4>
    <div id="gh-comments-list"></div>
    <a href="javascript:void(0)" id="gh-load-comments" class="btn" style="display:none">Load more comments</a>
    <noscript>
      <a href="https://github.com/DanielGibson/DanielGibson.github.io/issues/7"
         target='_blank' class='btn'>(Javascript is disabled)<br>View Comments on Github</a>
    </noscript>
  </div>

  <script type="text/javascript" src="../../../../js/github-comments.js"></script>
  <script type="text/javascript">
    DoGithubComments( 7 );
  </script>
  

</main>

      <footer class="footer">
        <ul class="footer-links">
          
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="../../../../images/hugo-logo.png" width="22" height="22" alt="hugo"></a>
          </li>
        </ul>
      </footer>

    </div>

    
  
  
  
  <script>
  

  for(h=1; h<=6; ++h) 
  {
    var hs = document.getElementsByTagName('h'+h);
    for(i=0; i<hs.length; ++i)
    {
      
      if(hs[i].id)
      {
        var l = document.createElement("a");
        l.href = "#" + hs[i].id;
        l.innerHTML = "# ";
        l.className = "headinglink";
        hs[i].insertBefore(l, hs[i].firstChild);
      }
    }
  }
  </script>
  
  </body>
  
</html>

